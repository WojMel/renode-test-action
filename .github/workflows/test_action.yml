name: Test action

on: [push,pull_request,workflow_dispatch]

jobs:
  test:
    strategy:
      matrix:
        os: [ubuntu-latest, windows-latest, macos-13]
    runs-on: ${{ matrix.os }}
    steps:
      - uses: actions/checkout@v4

      - name: Download Renode
        uses: ./

      - name: Verify if Renode is persistent
        run: renode --version | grep "Renode v" || exit 1
        shell: bash

      - name: Run sample test
        uses: ./
        with:
           tests-to-run:  __tests__/hello_world.robot

      - name: Verify that renode-test also works under CMD/PowerShell on Windows
        run: renode-test __tests__/hello_world.robot
        shell: cmd
        if: ${{ runner.os == 'Windows' }}
